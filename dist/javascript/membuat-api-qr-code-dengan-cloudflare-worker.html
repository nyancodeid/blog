<!DOCTYPE html>
<html lang="id-ID">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Membuat API Generate QR-Code dengan Cloudflare Worker | NyanDev Blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="36x36" href="/icons/android-icon-36x36.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
    <link rel="preconnect" href="https://cdn.statically.io">
    <link rel="preconnect" href="https://telegra.ph">
    <script src="https://cdn.statically.io/gh/aFarkas/lazysizes/gh-pages/lazysizes.min.js" async=""></script>
    <link rel="alternate" type="application/rss+xml" href="https://blog.nyandev.id/rss.xml" title="NyanDev Blog RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://blog.nyandev.id/feed.atom" title="NyanDev Blog Atom Feed">
    <link rel="alternate" type="application/json" href="https://blog.nyandev.id/feed.json" title="NyanDev Blog JSON Feed">
    <meta name="description" content="Bereksperimen dengan Cloudflare Worker dengan studi kasus membuat API Generate QR-Code">
    <meta name="keywords" content="javascript,worker,cloudflare,wrangler">
    <meta property="article:published_time" content="2020-03-04T03:55:23.000Z">
    <meta property="article:modified_time" content="2020-03-11T03:16:18.000Z">
    <meta property="og:site_name" content="NyanDev Blog">
    <meta property="og:title" content="Membuat API Generate QR-Code dengan Cloudflare Worker">
    <meta property="og:description" content="Bereksperimen dengan Cloudflare Worker dengan studi kasus membuat API Generate QR-Code">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://blog.nyandev.id/javascript/membuat-api-qr-code-dengan-cloudflare-worker.html">
    <meta property="og:image" content="https://blog.nyandev.id/images/covers/membuat-api-qr-code-dengan-cloudflare-worker.jpg">
    <meta name="twitter:title" content="Membuat API Generate QR-Code dengan Cloudflare Worker">
    <meta name="twitter:description" content="Bereksperimen dengan Cloudflare Worker dengan studi kasus membuat API Generate QR-Code">
    <meta name="twitter:url" content="https://blog.nyandev.id/javascript/membuat-api-qr-code-dengan-cloudflare-worker.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://blog.nyandev.id/images/covers/membuat-api-qr-code-dengan-cloudflare-worker.jpg">
    <meta property="og:image:alt" content="Membuat API Generate QR-Code dengan Cloudflare Worker">
    <meta property="og:image:width" content="450">
    <meta property="article:author" content="https://facebook.com/ryan.hac">
    <meta name="theme-color" content="#65c59a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/assets/css/0.styles.32b1d79a.css" as="style"><link rel="preload" href="/assets/js/app.7e510d46.js" as="script"><link rel="preload" href="/assets/js/2.9f835e0b.js" as="script"><link rel="preload" href="/assets/js/24.1874fb7b.js" as="script"><link rel="preload" href="/assets/js/4.40f398e1.js" as="script"><link rel="preload" href="/assets/js/6.fe87e115.js" as="script"><link rel="preload" href="/assets/js/9.8721d71e.js" as="script"><link rel="preload" href="/assets/js/8.921718ba.js" as="script"><link rel="prefetch" href="/assets/js/10.99d7ed95.js"><link rel="prefetch" href="/assets/js/11.9874722c.js"><link rel="prefetch" href="/assets/js/12.44d458dd.js"><link rel="prefetch" href="/assets/js/13.d175c0bc.js"><link rel="prefetch" href="/assets/js/14.7b0734d4.js"><link rel="prefetch" href="/assets/js/15.93154e45.js"><link rel="prefetch" href="/assets/js/16.57bb0bb9.js"><link rel="prefetch" href="/assets/js/17.fef3c5e9.js"><link rel="prefetch" href="/assets/js/18.d95f131f.js"><link rel="prefetch" href="/assets/js/19.27096e36.js"><link rel="prefetch" href="/assets/js/20.1803883b.js"><link rel="prefetch" href="/assets/js/21.3c882dde.js"><link rel="prefetch" href="/assets/js/22.d4e6a8ab.js"><link rel="prefetch" href="/assets/js/23.e60b0102.js"><link rel="prefetch" href="/assets/js/25.3b5a154d.js"><link rel="prefetch" href="/assets/js/26.f52819cd.js"><link rel="prefetch" href="/assets/js/27.3669038a.js"><link rel="prefetch" href="/assets/js/28.5f570948.js"><link rel="prefetch" href="/assets/js/29.694510fc.js"><link rel="prefetch" href="/assets/js/3.4bda5e48.js"><link rel="prefetch" href="/assets/js/30.ab8d1ccf.js"><link rel="prefetch" href="/assets/js/31.ac8d6686.js"><link rel="prefetch" href="/assets/js/32.c1b26e5a.js"><link rel="prefetch" href="/assets/js/33.9309aed6.js"><link rel="prefetch" href="/assets/js/34.3f8ec3a5.js"><link rel="prefetch" href="/assets/js/35.aa42c23e.js"><link rel="prefetch" href="/assets/js/36.12994f0d.js"><link rel="prefetch" href="/assets/js/37.73df454c.js"><link rel="prefetch" href="/assets/js/38.40f46242.js"><link rel="prefetch" href="/assets/js/39.dc358b15.js"><link rel="prefetch" href="/assets/js/40.f736adf1.js"><link rel="prefetch" href="/assets/js/41.564da301.js"><link rel="prefetch" href="/assets/js/42.d273b766.js"><link rel="prefetch" href="/assets/js/5.b7ea8e87.js"><link rel="prefetch" href="/assets/js/7.b95f864c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.32b1d79a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NyanDev Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Javascript" class="dropdown-title"><span class="title">Javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link router-link-active">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/preact/" class="nav-link">
  Preact
</a></li><li class="dropdown-item"><!----> <a href="/preact/belajar-preact/" class="nav-link">
  Series: Belajar Preact
</a></li></ul></div></div><div class="nav-item"><a href="/devops/" class="nav-link">
  Devops
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Others" class="dropdown-title"><span class="title">Others</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tips/" class="nav-link">
  Tips
</a></li><li class="dropdown-item"><!----> <a href="/informasi/" class="nav-link">
  Informasi
</a></li><li class="dropdown-item"><!----> <a href="/bookmark/" class="nav-link">
  Bookmark
</a></li></ul></div></div> <a href="https://github.com/nyancodeid/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Javascript" class="dropdown-title"><span class="title">Javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link router-link-active">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/preact/" class="nav-link">
  Preact
</a></li><li class="dropdown-item"><!----> <a href="/preact/belajar-preact/" class="nav-link">
  Series: Belajar Preact
</a></li></ul></div></div><div class="nav-item"><a href="/devops/" class="nav-link">
  Devops
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Others" class="dropdown-title"><span class="title">Others</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tips/" class="nav-link">
  Tips
</a></li><li class="dropdown-item"><!----> <a href="/informasi/" class="nav-link">
  Informasi
</a></li><li class="dropdown-item"><!----> <a href="/bookmark/" class="nav-link">
  Bookmark
</a></li></ul></div></div> <a href="https://github.com/nyancodeid/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="membuat-api-generate-qr-code-menggunakan-cloudflare-worker"><a href="#membuat-api-generate-qr-code-menggunakan-cloudflare-worker" class="header-anchor">#</a> Membuat API Generate QR-Code menggunakan Cloudflare Worker</h1> <div class="author d-flex"><div class="author-main d-flex"><div class="author-avatar"><img src="/images/profiles/avatar.jpg" alt="Ryan Aunur Rassyid" width="48" height="48"> <!----></div> <div class="author-detail"><div><span>Ryan Aunur Rassyid</span> <div class="author-detail--follow"><button>Follow</button></div></div> <span>Mar 4, 2020 · 8 min read</span></div></div> <div class="author-social d-flex"><div class="author-social-wrapper d-flex"><div><a href="https://twitter.com/AunurRyan" target="_blank"><svg width="29" height="29" class="q"><path d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></a></div> <div><a href="https://www.facebook.com/ryan.hac" target="_blank"><svg width="29" height="29" class="q"><path d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79"></path></svg></a></div> <div><a href="https://medium.com/@ryandevstudio" target="_blank"><svg enable-background="new 0 0 24 24" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m7.996 21.324c0 .695-.521.982-1.098.695l-6.228-3.113c-.188-.089-.346-.238-.475-.447s-.195-.417-.195-.622v-15.227c0-.568.341-.825 1.112-.441l6.844 3.42c.099.099.026-.581.04 15.735zm.857-14.32 7.152 11.568-7.152-3.553zm15.147.241v14.079c0 .223-.062.403-.188.541-.125.138-.295.207-.509.207s-.424-.058-.629-.174l-5.906-2.939zm-.04-1.603c0 .027-1.145 1.895-3.435 5.603s-3.632 5.88-4.025 6.512l-5.223-8.469 4.339-7.039c.236-.388.72-.456 1.045-.294l7.246 3.607c.035.017.053.044.053.08z"></path></svg></a></div></div></div></div> <p class="featured-image"><img alt="Membuat API Generate QR-Code dengan Cloudflare Worker" title="Membuat API Generate QR-Code dengan Cloudflare Worker | NyanDev Blog" data-src="/images/covers/membuat-api-qr-code-dengan-cloudflare-worker.jpg" src="/images/covers/membuat-api-qr-code-dengan-cloudflare-worker.jpg" class="no-zoom lazy"> <span class="featured-image--subtitle">(featured image by <u>Guilherme Cunha</u> on <u><a href="https://unsplash.com/photos/4zwozQxDbD4"   rel="noopener noreferrer" target="_blank">unsplash.com</a></u>)</span></p> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>Berawal dari konsep <strong>Serverless</strong>, kita tau bahwa nodejs sudah hadir diberbagai Cloud Provider yang menyediakan produk serverless nya. Contoh saja <strong>AWS</strong> dengan <strong>AWS Lambda</strong> nya dan <strong>Google Firebase</strong> dengan <strong>Firebase Function</strong> nya. Kita tidak ada masalah tentunya, toh dengan <em>serverless</em> kita nggak lagi peduli dengan server, kita hanya berharap aplikasi kita berjalan dengan baik.</p> <p>Jadi kenapa kita bahas <em>serverless</em> kalau tidak ada masalah? ya ini cukup menarik. Kita tau bahwa <em>serverless</em> punya kelemahan yaitu <em>boot time</em>. Jadi selama app kita di-<em>serverless</em> nggak ada yang akses selama waktu tenggang (idle) yang sudah ditentukan provider maka app kita akan dibekukan. Jadi, setiap kali ada yang akses maka akan dicairkan kembali atau dalam istilahnya adalah <em>cold start</em>. Ini memakan waktu beberapa ms atau detik sih (berterima kasih ke fitur snapshot nya <code>V8</code>) karena untuk nodejs kita perlu install dependency sebelum kita bisa menjalankan program seutuhnya.</p> <a href="https://dashbird.io/blog/can-we-solve-serverless-cold-starts" target="_blank" class="link-preview"><div class="link-preview--content"><p class="title">Can We Solve Serverless Cold Starts?</p><p>What are cold starts and practical ways to solve them</p> <p>dashbird.io</p></div><div class="link-preview--thumbnail" style="background-image:url(https://dashbird.io/images/blog/2019-03-20/cold-ice-optimized-square.jpg);"></div></a><p>Nah NodeJS pada versi baru-baru ini merilis fitur yang sudah lama dinanti yaitu <strong>Worker</strong>. Worker ini memungkinkan kita menjalankan sebuah pekerjaan di thread lain yang tidak membebankan main thread. Fitur inilah yang dipakai oleh <strong>Cloudflare Worker</strong>. Fitur ini menyelesaikan masalah <em>cold start</em> dari serverless sebelumnya karena server hanya menjalankan script worker kita saja dan server selalu standby (tidak mati). Cold start yang diperlukan hanya lah <strong>4ms</strong>, ini berbeda jauh bahkan 50x lebih cepat.</p> <p><img src="https://telegra.ph/file/9a8ce65436f84d53c5a18.png" alt="NodeJS Workers"> <em>NodeJS Thread - source <a href="https://nodesource.com/blog/worker-threads-nodejs" target="_blank" rel="noopener noreferrer">nodesource.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></em></p> <div class="custom-block tip"><p class="custom-block-title">Gaol</p> <p>Goal dari tutorial kali ini adalah Membuat API yang bisa generate QR-Code berupa gambar dari text yang kita inputkan.</p></div> <h2 id="persiapan"><a href="#persiapan" class="header-anchor">#</a> Persiapan</h2> <p>Sebelum kita masuk tutorial kita perlu mempersiapkan tools yang akan kita gunakan, yaitu:</p> <ul><li>Node.js (<code>^v12.16</code>)</li> <li>Wrangler (<code>^v1.6.0</code>)</li></ul> <p>Yang belum install node.js silahkan install terlebih dahulu sesuai dengan platform yang digunakan masing-masing. Ingat bahwa gunakan versi <code>12</code> keatas atau LTS terbaru ya.</p> <p>Selanjutnya kita install tool bernama <code>wrangler</code>, tool (CLI) ini disediakan secara official oleh Cloudflare Worker sendiri untuk memudahkan kita membuat project di Cloudflare Worker. Cara installnya adalah:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">npm</span> <span class="token function">install</span> -g @cloudflare/wrangler
<span class="token comment"># atau untuk pengguna `yarn`</span>
$ <span class="token function">yarn</span> global <span class="token function">add</span> @cloudflare/wrangler
</code></pre></div><p>Jika sudah tinggal kita test menampilkan versi dengan menuliskan perintah dibawah ini:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ node -v
<span class="token comment"># v12.16.0</span>
$ wrangler -V
<span class="token comment"># wrangler v1.6.0</span>
</code></pre></div><p>Selanjutnya kita akan configurasi wrangler supaya bisa deploy ke akun <strong>Cloudflare Worker</strong> kita dengan cara ketik perintah:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ wrangler config
</code></pre></div><p>Untuk API Key nya kita buat dulu di:
<a href="https://dash.cloudflare.com/profile/api-tokens" target="_blank" rel="noopener noreferrer">https://dash.cloudflare.com/profile/api-tokens<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Lalu klik &quot;<strong>Create Token</strong>&quot;, Selanjutnya isi permission nya sesuai dengan gambar dibawah ini. Sesuaikan inputan yang lain lalu klik &quot;<strong>Continue to summary</strong>&quot; dan copy tokennya.</p> <p><img src="https://telegra.ph/file/e80da438e093dff6c22cb.png" alt="Cloudflare Token"> <em>Create Token Cloudflare Worker Permissions</em></p> <div class="custom-block warning"><p class="custom-block-title">Penting</p> <p>Karena token tidak bisa dilihat kembali harap simpan baik baik kode token yang sudah diberikan. Seperti halnya password pastikan kamu menyimpannya dengan aman.</p></div> <h2 id="setup-project"><a href="#setup-project" class="header-anchor">#</a> Setup Project</h2> <p>Karena semua tool yang dibutuhkan sudah siap, selanjutnya kita akan setup project kita menggunakan <em>wrangler</em>. Buka command line dan arahkan ke <em>directory</em> kerja kita. Untuk setup project dengan menggunakan <em>wrangler</em> kita bisa menjalankan perintah:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ wrangler generate qr-code
<span class="token comment"># open `qr-code` directory</span>
$ <span class="token builtin class-name">cd</span> qr-code
</code></pre></div><p>Kita disini akan coding dari awal tanpa menggunakan template. Disini wrangler akan membuat folder sesuai dengan nama project kita yaitu <code>qr-code</code>. Selanjutnya kita buka directory nya dan kita cek terlebih dahulu file <code>wrangler.toml</code> yang digunakan untuk config project wrangler kita. Konfigurasikan file <code>wrangler.toml</code> seperti berikut ini:</p> <div class="language-git extra-class"><pre class="language-git"><code>name = <span class="token string">&quot;qr-api&quot;</span>
<span class="token deleted">-type = &quot;javascript&quot;</span>
<span class="token inserted">+type = &quot;webpack&quot;</span>
<span class="token deleted">-account_id = &quot;&quot;</span>
<span class="token inserted">+account_id = &quot;YOUR_ACCOUNT_ID&quot;</span>
workers_dev = true
route = <span class="token string">&quot;&quot;</span>
zone_id = <span class="token string">&quot;&quot;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">Catatan</p> <p>Jika field <code>account_id</code> sudah ada, kamu tidak perlu menggantinya.</p></div> <p>Disini <code>type</code> diubah dari javascript ke webpack karena kita akan menggunakan <em>bundler</em> <strong>webpack</strong> untuk meng-<em>compile</em> npm package kita supaya menjadi satu file <code>.js</code>. Kita tidak perlu melakukkan konfigurasi webpack karena wrangler sudah melakukkannya untuk kita.</p> <h2 id="coding"><a href="#coding" class="header-anchor">#</a> Coding</h2> <p>Untuk proses koding sendiri kita akan bekerja pada file <code>index.js</code>. Pada Cloudflare Worker kita akan mendefinisikan function <code>handleRequest</code> yang menangani request atau yang bertugas sebagai gateway dari request kita. Karena Cloudflare menggunakan <code>fetch</code> maka kita harus tau terlebih dahulu apa itu <code>Request</code> dan <code>Response</code>.</p> <a href="https://developer.mozilla.org/id/docs/Web/API/Fetch_API" target="_blank" class="link-preview"><div class="link-preview--content"><p class="title">Fetch API - Referensi API Web | MDN</p><p>XMLHttpRequest</p> <p>developer.mozilla.org</p></div><div class="link-preview--thumbnail" style="background-image:url(https://developer.mozilla.org/static/img/opengraph-logo.72382e605ce3.png);"></div></a><p>Oke kita koding saja supaya tau penerapan nya.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Request kita akan dihandle oleh Listener tersebut jadi fungsi ini wajib ada pada script kalian. Bahasa mudahnya adalah <code>&quot;Jika ada request maka jalankan fungsi ini&quot;</code>. Nah selanjutnya adalah kita buat <code>handleRequest</code> untuk mempermudah kita menangani request dan melakukkan <em>decision</em> atau routing.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'GET'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
      <span class="token keyword">const</span> text <span class="token operator">=</span> url<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span>

      <span class="token keyword">return</span> <span class="token function">generateQrCode</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Internal Server Error'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        status<span class="token operator">:</span> <span class="token number">500</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Method Not Allowed'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      status<span class="token operator">:</span> <span class="token number">405</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Rencannya kita melempar <code>text</code> kedalam url query yang memudahkan kita memanggil Worker kita bahkan didalam element <code>&lt;img /&gt;</code> sekalipun. Karena merunut penulis, jika kita mengirim request dengan method POST maka itu hanya bisa terjadi jika kita menggunakan <code>fetch</code> atau <code>ajax</code> (XHR). Jadi akan lebih jadi merepotkan. Kita akan memperlakukkan API kita sama halnya dengan file image yang langsung di panggil saja tanpa perlu melakukkan ajax dan lain sebagainya. URL pemanggilan nya akan kita buat seperti ini:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>https://domain.com?text<span class="token operator">=</span>TEXT_QR_CODE_KITA
</code></pre></div><p>Selanjutnya kita akan membuat function <code>generateQrCode</code>, tapi sebelum itu kita harus install package yang memungkinkan kita generate gambar kode qr dengan mudah yaitu <code>qr-image</code>. Kita install menggunakan perintah:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">yarn</span> <span class="token function">add</span> qr-image
</code></pre></div><p>Lalu kita bisa import package nya, dan pastikan letakkan di atas sendiri. Karena kita hanya perlu method <code>imageSync</code> maka kita import method <code>imageSync</code> saja. Dengan cara seperti berikut:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> imageSync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'qr-image'</span>
</code></pre></div><p>Sekarang kita bisa buat function <code>generateQrCode</code> yang fungsi nya merubah text yang diminta menjadi gambar QR Code. Kita juga akan memasang <code>Cache-Control</code> pada header response kita supaya tidak melakukkan request berulang untuk text yang sama, kita bisa menghemat request dengan ini.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">generateQrCode</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  text
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token function">imageSync</span><span class="token punctuation">(</span>text <span class="token operator">||</span> <span class="token string">'https://blog.nyandev.id'</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'image/png'</span><span class="token punctuation">,</span>
      <span class="token string">'Cache-Control'</span><span class="token operator">:</span> <span class="token string">'public, max-age=31536000'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Untuk opsi lain seperti merubah lebar margin, <em>error correction level</em>, dan type image (<code>png</code>, <code>svg</code>, <code>eps</code>, dan <code>pdf</code>) kamu bisa lihat di halaman NPM nya untuk melihat opsi lain yang ada pada package <code>qr-image</code>.</p> <p><img src="https://telegra.ph/file/e49a121b2d1d5452618bc.png" alt="qr-image"> <em>Konfigurasi lain yang ada pada package <code>qr-image</code></em></p> <p>Oke semua script sudah ada dan yang dibutuhkan sudah siap. Selanjutnya kita akan melakukkan test.</p> <h2 id="preview"><a href="#preview" class="header-anchor">#</a> Preview</h2> <p>Wrangler menyediakan fitur <code>preview</code> untuk melakukkan uji coba atau test terhadap script worker yang akan kita publish. Caranya dengan menjalankan perintah berikut:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ wrangler preview
</code></pre></div><p>Maka browser akan membuka website yang memungkinkan kita melakukkan test, dan melihat console dari program javascript kita. Domain yang disediakan memang <code>example.com</code> tapi jangan khawatir ini hanya untuk test saja dan memang seperti itu adanya.</p> <p><img src="https://telegra.ph/file/85d4c27668a1862a86fe8.png" alt="Wrangler Preview"> <em>Preview Script sebelum kita Deploy</em></p> <h2 id="build"><a href="#build" class="header-anchor">#</a> Build</h2> <p>Pada tahap ini script kita sudah berjalan sesuai dengan keinginan kita. Selanjutnya adalah prosess deploy, tapi judul tahap ini <code>build</code>?. Ya, wrangler menyediakan perintah build karena hasil build script kita yang ada pada <code>worker/script.js</code> juga bisa kita manfaatkan untuk Web Worker kita sendiri.</p> <p>Untuk build script, kita bisa menjalankan perintah seperti berikut:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ wrangler build
</code></pre></div><p>Prosess build script:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>⬇️ Installing wranglerjs<span class="token punctuation">..</span>.
⬇️ Installing wasm-pack<span class="token punctuation">..</span>.
 Built successfully, built project size is <span class="token number">44</span> KiB.
</code></pre></div><h2 id="deploy"><a href="#deploy" class="header-anchor">#</a> Deploy</h2> <p>Akhirnya kita bisa melakukkan deploy script kita ke Cloudflare Worker. Untuk melakukkan deploy kita perlu tau bahwa perintah ini tidak memerlukkan perintah sebelumnya (<code>build</code>) karena secara otomatis perintah ini akan build sekaligus mempublish script kita.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">sudo</span> wrangler publish
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">Catatan</p> <p>Karena <code>wrangler publish</code> memerlukkan informasi API KEY yang disimpan kedalam folder dengan akses Administrasi/root maka kita perlu menambahkan <code>sudo</code> bagi pengguna Linux.</p></div> <p>Setelah prosess deploy berhasil kita juga bisa tau alamat worker kita.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>Successfully published your script to https://qr-api.nyandev.workers.dev
</code></pre></div><p>Contoh response worker yang berjalan dengan sangat baik:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ http https://qr-api.nyandev.workers.dev?text<span class="token operator">=</span>nyandev
<span class="token comment"># Result</span>
HTTP/1.1 <span class="token number">200</span> OK
CF-RAY: 570693510c77e811-LAX
Cache-Control: public, max-age<span class="token operator">=</span><span class="token number">31536000</span>
Connection: keep-alive
Content-Length: <span class="token number">336</span>
Content-Type: image/png
Date: Sat, 07 Mar <span class="token number">2020</span> <span class="token number">19</span>:03:15 GMT
Expect-CT: max-age<span class="token operator">=</span><span class="token number">604800</span>, report-uri<span class="token operator">=</span><span class="token string">&quot;https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct&quot;</span>
Server: cloudflare
Vary: Accept-Encoding
</code></pre></div><h2 id="hasil-akhir"><a href="#hasil-akhir" class="header-anchor">#</a> Hasil Akhir</h2> <p>Berikut adalah script penuh dari hasil akhir kita dalam membuat generator qr-code:</p> <div id="gist-area"><p>Loading</p></div> <p>Kamu bisa melihat hasil akhir dan script sepenuhnya di Repository yang sudah saya buat dibawah ini:</p> <a href="https://github.com/nyancodeid/qr-code-api" target="_blank" class="link-preview"><div class="link-preview--content"><p class="title">GitHub - nyancodeid/qr-code-api: Cloudflare Worker Generate QR Code</p><p>Cloudflare Worker Generate QR Code. Contribute to nyancodeid/qr-code-api development by creating an account on GitHub.</p> <p>github.com</p></div><div class="link-preview--thumbnail" style="background-image:url(https://avatars1.githubusercontent.com/u/24630806?s=400&amp;v=4);"></div></a><h2 id="referensi"><a href="#referensi" class="header-anchor">#</a> Referensi</h2> <a href="https://developers.cloudflare.com/workers/tutorials/build-a-serverless-function" target="_blank" class="link-preview"><div class="link-preview--content"><p class="title">Build a Serverless Function | Cloudflare Workers</p><p>Use Cloudflare’s APIs and edge network to build secure, ultra-fast applications.</p> <p>developers.cloudflare.com</p></div><div class="link-preview--thumbnail" style="background-image:url(https://telegra.ph/file/73935aea4865c151c4c70.png);"></div></a><div id="disqus_thread"><div id="disqus_empty"></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/nyancodeid/blog/edit/master/javascript/membuat-api-qr-code-dengan-cloudflare-worker.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/11/2020, 10:16:18 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.7e510d46.js" defer></script><script src="/assets/js/2.9f835e0b.js" defer></script><script src="/assets/js/24.1874fb7b.js" defer></script><script src="/assets/js/4.40f398e1.js" defer></script><script src="/assets/js/6.fe87e115.js" defer></script><script src="/assets/js/9.8721d71e.js" defer></script><script src="/assets/js/8.921718ba.js" defer></script>
  </body>
</html>
